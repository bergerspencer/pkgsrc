$NetBSD: patch-CMakeLists.txt,v 1.1 2017/02/13 13:39:55 fhajny Exp $

Solaris ld: Provided assembler is not PIC, so we pass "-mimpure-text"
            to the compiler so it doesn't send "-ztext" to ld.

Solaris ld: Passing "-Wa,--noexecstack" to gcc will generate an ELF section
            requesting a non executable stack. I don't know if Solaris ld
            is complying or just ignoring it.

--- CMakeLists.txt.orig	2019-01-23 09:47:18.000000000 +0000
+++ CMakeLists.txt
@@ -620,7 +620,12 @@ if(ENABLE_SHARED)
         elseif(CYGWIN)
             # Cygwin is not officially supported or tested. MinGW with msys is recommended.
         else()
-            list(APPEND LINKER_OPTIONS "-Wl,-Bsymbolic,-znoexecstack")
+            if (${CMAKE_SYSTEM_NAME} MATCHES "SunOS")
+                list(APPEND LINKER_OPTIONS "-mimpure-text -Wl,-M,/usr/lib/ld/map.noexstk")
+            else()
+                list(APPEND LINKER_OPTIONS "-Wl,-znoexecstack")
+            endif()
+            list(APPEND SHARED_LINKER_OPTIONS "-Wl,-Bsymbolic")
         endif()
     endif()
     set_target_properties(x265-shared PROPERTIES SOVERSION ${X265_BUILD})
@@ -641,8 +646,8 @@ if(ENABLE_SHARED)
     endif()
     if(LINKER_OPTIONS)
         # set_target_properties can't do list expansion
-        string(REPLACE ";" " " LINKER_OPTION_STR "${LINKER_OPTIONS}")
-        set_target_properties(x265-shared PROPERTIES LINK_FLAGS "${LINKER_OPTION_STR}")
+        string(REPLACE ";" " " SHARED_LINKER_OPTION_STR "${LINKER_OPTIONS} ${SHARED_LINKER_OPTIONS}")
+        set_target_properties(x265-shared PROPERTIES LINK_FLAGS "${SHARED_LINKER_OPTION_STR}")
     endif()
 endif()
 
